"use strict";(self.webpackChunkservice_display=self.webpackChunkservice_display||[]).push([[700],{1700(e,a,t){t.d(a,{S:()=>w});var r=t(950),s=t(6522),n=t(4152),i=t(1416),c=t(2826),o=t(1447);const d=16,l=(e,a)=>{const t=r.UINT32_BE.get(e,a+8),s=r.UINT32_BE.get(e,a+12);return{startTime:r.UINT32_BE.get(e,a),endTime:r.UINT32_BE.get(e,a+4),startOffset:4294967295===t?void 0:t,endOffset:4294967295===s?void 0:s}};var u=t(3176);function h(e){switch(e){case 2:return 6;case 3:case 4:return 10;default:throw p(e)}}function g(e){return{status:{tag_alter_preservation:n.mh(e,0,6),file_alter_preservation:n.mh(e,0,5),read_only:n.mh(e,0,4)},format:{grouping_identity:n.mh(e,1,7),compression:n.mh(e,1,3),encryption:n.mh(e,1,2),unsynchronisation:n.mh(e,1,1),data_length_indicator:n.mh(e,1,0)}}}function m(e,a,t){switch(a){case 2:return function(e,a,t){const s={id:(0,u.c)(e.subarray(0,3),"ascii"),length:r.UINT24_BE.get(e,3)};s.id.match(/^[A-Z0-9]{3}$/)||t.addWarning("Invalid ID3v2.".concat(a," frame-header-ID: ").concat(s.id));return s}(e,a,t);case 3:case 4:return function(e,a,t){const s={id:(0,u.c)(e.subarray(0,4),"ascii"),length:(4===a?i.St:r.UINT32_BE).get(e,4),flags:g(e.subarray(8,10))};s.id.match(/^[A-Z0-9]{4}$/)||t.addWarning("Invalid ID3v2.".concat(a," frame-header-ID: ").concat(s.id));return s}(e,a,t);default:throw p(a)}}function p(e){throw new I("Unexpected majorVer: ".concat(e))}const f=s("music-metadata:id3v2:frame-parser"),y="latin1",T={encoding:y,bom:!1};function b(e){return"RX"===e?"Remix":"CR"===e?"Cover":e.match(/^\d*$/)?c.jR[Number.parseInt(e,10)]:void 0}class v{constructor(e,a){this.major=e,this.warningCollector=a}readData(e,a,t){if(0===e.length)return void this.warningCollector.addWarning("id3v2.".concat(this.major," header has empty tag type=").concat(a));const{encoding:s,bom:c}=i.YF.get(e,0),o=e.length;let u=0,g=[];const p=v.getNullTerminatorLength(s);let w;switch(f("Parsing tag type=".concat(a,", encoding=").concat(s,", bom=").concat(c)),"TXXX"!==a&&"T"===a[0]?"T*":a){case"T*":case"GRP1":case"GP1":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":{let t;try{t=v.trimNullPadding(n.sc(e.subarray(1),s))}catch(k){if(k instanceof Error){this.warningCollector.addWarning("id3v2.".concat(this.major," type=").concat(a," header has invalid string value: ").concat(k.message));break}throw k}switch(a){case"TMCL":case"TIPL":case"IPLS":g=v.functionList(this.splitValue(a,t));break;case"TRK":case"TRCK":case"TPOS":case"TIT1":case"TIT2":case"TIT3":g=t;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":g=this.splitValue(a,t);break;case"TCO":case"TCON":g=this.splitValue(a,t).map(e=>function(e){const a=[];let t,r="";for(const s of e)if("string"===typeof t)if("("===s&&""===t)r+="(",t=void 0;else if(")"===s){""!==r&&(a.push(r),r="");const e=b(t);e&&a.push(e),t=void 0}else t+=s;else"("===s?t="":r+=s;return r&&(0===a.length&&r.match(/^\d*$/)&&(r=b(r)),r&&a.push(r)),a}(e)).reduce((e,a)=>e.concat(a),[]);break;case"PCS":case"PCST":g=this.major>=4?this.splitValue(a,t):[t],g=Array.isArray(g)&&""===g[0]?1:0;break;default:g=this.major>=4?this.splitValue(a,t):[t]}break}case"TXXX":{const t=v.readIdentifierAndData(e.subarray(1),s);g={description:t.id,text:this.splitValue(a,n.sc(t.data,s).replace(/\x00+$/,""))};break}case"PIC":case"APIC":if(t){const a={};switch(e=e.subarray(1),this.major){case 2:a.format=n.sc(e.subarray(0,3),"latin1"),e=e.subarray(3);break;case 3:case 4:w=n.sX(e,y),a.format=n.sc(e.subarray(0,w),y),e=e.subarray(w+1);break;default:throw function(e){throw new I("Unexpected majorVer: ".concat(e))}(this.major)}a.format=v.fixPictureMimeType(a.format),a.type=i.n5[e[0]],e=e.subarray(1),w=n.sX(e,s),a.description=n.sc(e.subarray(0,w),s),e=e.subarray(w+p),a.data=e,g=a}break;case"CNT":case"PCNT":g=(0,n.ku)(e);break;case"SYLT":{const a=i.aY.get(e,0);e=e.subarray(i.aY.len);const t={descriptor:"",language:a.language,contentType:a.contentType,timeStampFormat:a.timeStampFormat,syncText:[]};let s=!1;for(;e.length>0;){const n=v.readNullTerminatedString(e,a.encoding);if(e=e.subarray(n.len),s){const a=r.UINT32_BE.get(e,0);e=e.subarray(r.UINT32_BE.len),t.syncText.push({text:n.text,timestamp:a})}else t.descriptor=n.text,s=!0}g=t;break}case"ULT":case"USLT":case"COM":case"COMM":{const a=i.Jp.get(e,u);u+=i.Jp.len;const t=v.readNullTerminatedString(e.subarray(u),a.encoding);u+=t.len;const r=v.readNullTerminatedString(e.subarray(u),a.encoding);g={language:a.language,descriptor:t.text,text:r.text};break}case"UFID":{const a=v.readIdentifierAndData(e,y);g={owner_identifier:a.id,identifier:a.data};break}case"PRIV":{const a=v.readIdentifierAndData(e,y);g={owner_identifier:a.id,data:a.data};break}case"POPM":{e=e.subarray(u);const t=v.readNullTerminatedString(e,T),s=t.text;if(0===(e=e.subarray(t.len)).length){this.warningCollector.addWarning("id3v2.".concat(this.major," type=").concat(a," POPM frame missing rating byte")),g={email:s,rating:0,counter:void 0};break}const i=r.UINT8.get(e,0),c=e.subarray(r.UINT8.len);g={email:s,rating:i,counter:c.length>0?(0,n.ku)(c):void 0};break}case"GEOB":{const a=i.YF.get(e,0);e=e.subarray(1);const t=v.readNullTerminatedString(e,T),r=t.text;e=e.subarray(t.len);const s=v.readNullTerminatedString(e,a),n=s.text;e=e.subarray(s.len);const c=v.readNullTerminatedString(e,a);g={type:r,filename:n,description:c.text,data:e=e.subarray(c.len)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":g=v.readNullTerminatedString(e,T).text;break;case"WXXX":{const a=i.YF.get(e,0);e=e.subarray(1);const t=v.readNullTerminatedString(e,a),r=t.text;e=e.subarray(t.len),g={description:r,url:v.trimNullPadding(n.sc(e,y))};break}case"WFD":case"WFED":{const a=i.YF.get(e,0);e=e.subarray(1),g=v.readNullTerminatedString(e,a).text;break}case"MCDI":g=e.subarray(0,o);break;case"CHAP":{f("Reading CHAP"),w=n.sX(e,y);const a={label:n.sc(e.subarray(0,w),y),info:l(e,w+1),frames:new Map};for(u+=w+1+d;u<o;){const r=m(e.subarray(u),this.major,this.warningCollector);u+=h(this.major);const s=this.readData(e.subarray(u,u+r.length),r.id,t);u+=r.length,a.frames.set(r.id,s)}g=a;break}case"CTOC":{f("Reading CTOC");const a=n.sX(e,y),r=n.sc(e.subarray(0,a),y);u=a+1;const s=e[u++],i=0!==(2&s),c=0!==(1&s),d=e[u++],l=[];for(let t=0;t<d&&u<o;t++){const a=n.sX(e.subarray(u),y),t=n.sc(e.subarray(u,u+a),y);l.push(t),u+=a+1}const p={label:r,flags:{topLevel:i,ordered:c},childElementIds:l,frames:new Map};for(;u<o;){const a=m(e.subarray(u),this.major,this.warningCollector);u+=h(this.major);const r=this.readData(e.subarray(u,u+a.length),a.id,t);u+=a.length,p.frames.set(a.id,r)}g=p;break}default:f("Warning: unsupported id3v2-tag-type: ".concat(a))}return g}static readNullTerminatedString(e,a){const t=a.bom?2:0,r=e.length,s=e.subarray(t),i=n.sX(s,a.encoding);if(i>=s.length)return{text:n.sc(s,a.encoding),len:r};const c=s.subarray(0,i);return{text:n.sc(c,a.encoding),len:t+i+v.getNullTerminatorLength(a.encoding)}}static fixPictureMimeType(e){switch(e=e.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return e}static functionList(e){const a={};for(let t=0;t+1<e.length;t+=2){const r=e[t+1].split(",");a[e[t]]=a[e[t]]?a[e[t]].concat(r):r}return a}splitValue(e,a){let t;return this.major<4?(t=a.split(/\x00/g),t.length>1?this.warningCollector.addWarning("ID3v2.".concat(this.major," ").concat(e," uses non standard null-separator.")):t=a.split(/\//g)):t=a.split(/\x00/g),v.trimArray(t)}static trimArray(e){return e.map(e=>v.trimNullPadding(e).trim())}static trimNullPadding(e){let a=e.length;for(;a>0&&0===e.charCodeAt(a-1);)a--;return a===e.length?e:e.slice(0,a)}static readIdentifierAndData(e,a){const t=v.readNullTerminatedString(e,{encoding:a,bom:!1});return{id:t.text,data:e.subarray(t.len)}}static getNullTerminatorLength(e){return e.startsWith("utf-16")?2:1}}class I extends((0,o.fO)("id3v2")){}class w{constructor(){this.tokenizer=void 0,this.id3Header=void 0,this.metadata=void 0,this.headerType=void 0,this.options=void 0}static removeUnsyncBytes(e){let a=0,t=0;for(;a<e.length-1;)a!==t&&(e[t]=e[a]),a+=255===e[a]&&0===e[a+1]?2:1,t++;return a<e.length&&(e[t++]=e[a]),e.subarray(0,t)}static readFrameData(e,a,t,r,s){var n,i;const c=new v(t,s);switch(t){case 2:return c.readData(e,a.id,r);case 3:case 4:return null!==(n=a.flags)&&void 0!==n&&n.format.unsynchronisation&&(e=w.removeUnsyncBytes(e)),null!==(i=a.flags)&&void 0!==i&&i.format.data_length_indicator&&(e=e.subarray(4,e.length)),c.readData(e,a.id,r);default:throw function(e){throw new I("Unexpected majorVer: ".concat(e))}(t)}}static makeDescriptionTagName(e,a){return e+(a?":".concat(a):"")}async parse(e,a,t){this.tokenizer=a,this.metadata=e,this.options=t;const r=await this.tokenizer.readToken(i.yW);if("ID3"!==r.fileIdentifier)throw new I("expected ID3-header file-identifier 'ID3' was not found");this.id3Header=r,this.headerType="ID3v2.".concat(r.version.major),await(r.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(r.size));const s=w.mapId3v2Chapters(this.metadata.native[this.headerType]);this.metadata.setFormat("chapters",s)}async parseExtendedHeader(){const e=await this.tokenizer.readToken(i.nl),a=e.size-i.nl.len;return a>0?this.parseExtendedHeaderData(a,e.size):this.parseId3Data(this.id3Header.size-e.size)}async parseExtendedHeaderData(e,a){return await this.tokenizer.ignore(e),this.parseId3Data(this.id3Header.size-a)}async parseId3Data(e){const a=await this.tokenizer.readToken(new r.Uint8ArrayType(e));for(const t of this.parseMetadata(a))if("TXXX"===t.id)t.value&&await this.handleTag(t,t.value.text,()=>t.value.description);else await(Array.isArray(t.value)?Promise.all(t.value.map(e=>this.addTag(t.id,e))):this.addTag(t.id,t.value))}async handleTag(e,a,t){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e=>e;await Promise.all(a.map(a=>this.addTag(w.makeDescriptionTagName(e.id,t(a)),r(a))))}async addTag(e,a){await this.metadata.addTag(this.headerType,e,a)}parseMetadata(e){let a=0;const t=[];for(;a!==e.length;){const r=h(this.id3Header.version.major);if(a+r>e.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const s=e.subarray(a,a+r);a+=r;const n=m(s,this.id3Header.version.major,this.metadata),i=e.subarray(a,a+n.length);a+=n.length;const c=w.readFrameData(i,n,this.id3Header.version.major,!this.options.skipCovers,this.metadata);c&&t.push({id:n.id,value:c})}return t}static mapId3v2Chapters(e){if(!e)return;const a=e.filter(e=>"CHAP"===e.id);if(null===a||void 0===a||!a.length)return;const t=e.filter(e=>"CTOC"===e.id),r=null===t||void 0===t?void 0:t.find(e=>{var a;return null===(a=e.value.flags)||void 0===a?void 0:a.topLevel}),s=new Map;for(const o of a)s.set(o.value.label,o.value);const n=null===r||void 0===r?void 0:r.value.childElementIds,i=[],c=null!==n&&void 0!==n?n:[...s.keys()];for(const o of c){const e=s.get(o);if(!e)continue;const a=e.frames,t=a.get("TIT2");t&&i.push({id:o,title:t,url:a.get("WXXX"),start:e.info.startTime/1e3,end:e.info.endTime/1e3,image:a.get("APIC")})}return n||i.sort((e,a)=>e.start-a.start),i.length?i:void 0}}}}]);
//# sourceMappingURL=700.fb292553.chunk.js.map