"use strict";(self.webpackChunkservice_display=self.webpackChunkservice_display||[]).push([[209],{6209:(a,e,t)=>{t.d(e,{S:()=>p});var r=t(9726),s=t(4152),i=t(6522),n=t(1416),c=t(2826),o=t(1447);const d=i("music-metadata:id3v2:frame-parser"),l="latin1";function h(a){return"RX"===a?"Remix":"CR"===a?"Cover":a.match(/^\d*$/)?c.jR[Number.parseInt(a,10)]:void 0}class u{constructor(a,e){this.major=a,this.warningCollector=e}readData(a,e,t){if(0===a.length)return void this.warningCollector.addWarning("id3v2.".concat(this.major," header has empty tag type=").concat(e));const{encoding:i,bom:c}=n.YF.get(a,0),o=a.length;let m=0,p=[];const y=u.getNullTerminatorLength(i);let f;switch(d("Parsing tag type=".concat(e,", encoding=").concat(i,", bom=").concat(c)),"TXXX"!==e&&"T"===e[0]?"T*":e){case"T*":case"GRP1":case"IPLS":case"MVIN":case"MVNM":case"PCS":case"PCST":{let t;try{t=s.sc(a.subarray(1),i).replace(/\x00+$/,"")}catch(T){if(T instanceof Error){this.warningCollector.addWarning("id3v2.".concat(this.major," type=").concat(e," header has invalid string value: ").concat(T.message));break}throw T}switch(e){case"TMCL":case"TIPL":case"IPLS":p=u.functionList(this.splitValue(e,t));break;case"TRK":case"TRCK":case"TPOS":p=t;break;case"TCOM":case"TEXT":case"TOLY":case"TOPE":case"TPE1":case"TSRC":p=this.splitValue(e,t);break;case"TCO":case"TCON":p=this.splitValue(e,t).map(a=>function(a){const e=[];let t,r="";for(const s of a)if("string"===typeof t)if("("===s&&""===t)r+="(",t=void 0;else if(")"===s){""!==r&&(e.push(r),r="");const a=h(t);a&&e.push(a),t=void 0}else t+=s;else"("===s?t="":r+=s;return r&&(0===e.length&&r.match(/^\d*$/)&&(r=h(r)),r&&e.push(r)),e}(a)).reduce((a,e)=>a.concat(e),[]);break;case"PCS":case"PCST":p=this.major>=4?this.splitValue(e,t):[t],p=Array.isArray(p)&&""===p[0]?1:0;break;default:p=this.major>=4?this.splitValue(e,t):[t]}break}case"TXXX":{const t=u.readIdentifierAndData(a,m+1,o,i);p={description:t.id,text:this.splitValue(e,s.sc(t.data,i).replace(/\x00+$/,""))};break}case"PIC":case"APIC":if(t){const e={};switch(m+=1,this.major){case 2:e.format=s.sc(a.subarray(m,m+3),"latin1"),m+=3;break;case 3:case 4:f=s.sX(a,m,o,l),e.format=s.sc(a.subarray(m,f),l),m=f+1;break;default:throw function(a){throw new g("Unexpected majorVer: ".concat(a))}(this.major)}e.format=u.fixPictureMimeType(e.format),e.type=n.n5[a[m]],m+=1,f=s.sX(a,m,o,i),e.description=s.sc(a.subarray(m,f),i),m=f+y,e.data=a.subarray(m,o),p=e}break;case"CNT":case"PCNT":p=(0,s.ku)(a);break;case"SYLT":{const e=n.aY.get(a,0);m+=n.aY.len;const t={descriptor:"",language:e.language,contentType:e.contentType,timeStampFormat:e.timeStampFormat,syncText:[]};let s=!1;for(;m<o;){const i=u.readNullTerminatedString(a.subarray(m),e.encoding);if(m+=i.len,s){const e=r.UINT32_BE.get(a,m);m+=r.UINT32_BE.len,t.syncText.push({text:i.text,timestamp:e})}else t.descriptor=i.text,s=!0}p=t;break}case"ULT":case"USLT":case"COM":case"COMM":{const e=n.Jp.get(a,m);m+=n.Jp.len;const t=u.readNullTerminatedString(a.subarray(m),e.encoding);m+=t.len;const r=u.readNullTerminatedString(a.subarray(m),e.encoding);p={language:e.language,descriptor:t.text,text:r.text};break}case"UFID":{const e=u.readIdentifierAndData(a,m,o,l);p={owner_identifier:e.id,identifier:e.data};break}case"PRIV":{const e=u.readIdentifierAndData(a,m,o,l);p={owner_identifier:e.id,data:e.data};break}case"POPM":{f=s.sX(a,m,o,l);const e=s.sc(a.subarray(m,f),l);m=f+1;const t=o-m-1;p={email:e,rating:r.UINT8.get(a,m),counter:t>0?s.ku(a.subarray(m+1)):void 0};break}case"GEOB":{f=s.sX(a,m+1,o,i);const e=s.sc(a.subarray(m+1,f),l);m=f+1,f=s.sX(a,m,o,i);const t=s.sc(a.subarray(m,f),l);m=f+1,f=s.sX(a,m,o,i);const r=s.sc(a.subarray(m,f),l);m=f+1;p={type:e,filename:t,description:r,data:a.subarray(m,o)};break}case"WCOM":case"WCOP":case"WOAF":case"WOAR":case"WOAS":case"WORS":case"WPAY":case"WPUB":f=s.sX(a,m+1,o,i),p=s.sc(a.subarray(m,f),l);break;case"WXXX":{f=s.sX(a,m+1,o,i);const e=s.sc(a.subarray(m+1,f),i);m=f+("utf-16le"===i?2:1),p={description:e,url:s.sc(a.subarray(m,o),l)};break}case"WFD":case"WFED":p=s.sc(a.subarray(m+1,s.sX(a,m+1,o,i)),i);break;case"MCDI":p=a.subarray(0,o);break;default:d("Warning: unsupported id3v2-tag-type: ".concat(e))}return p}static readNullTerminatedString(a,e){let t=e.bom?2:0;const r=s.sX(a,t,a.length,e.encoding),i=a.subarray(t,r);return t="utf-16le"===e.encoding?r+2:r+1,{text:s.sc(i,e.encoding),len:t}}static fixPictureMimeType(a){switch(a=a.toLocaleLowerCase()){case"jpg":return"image/jpeg";case"png":return"image/png"}return a}static functionList(a){const e={};for(let t=0;t+1<a.length;t+=2){const r=a[t+1].split(",");e[a[t]]=e[a[t]]?e[a[t]].concat(r):r}return e}splitValue(a,e){let t;return this.major<4?(t=e.split(/\x00/g),t.length>1?this.warningCollector.addWarning("ID3v2.".concat(this.major," ").concat(a," uses non standard null-separator.")):t=e.split(/\//g)):t=e.split(/\x00/g),u.trimArray(t)}static trimArray(a){return a.map(a=>a.replace(/\x00+$/,"").trim())}static readIdentifierAndData(a,e,t,r){const i=s.sX(a,e,t,r),n=s.sc(a.subarray(e,i),r);return e=i+u.getNullTerminatorLength(r),{id:n,data:a.subarray(e,t)}}static getNullTerminatorLength(a){return"utf-16le"===a?2:1}}class g extends((0,o.fO)("id3v2")){}var m=t(3176);class p{constructor(){this.tokenizer=void 0,this.id3Header=void 0,this.metadata=void 0,this.headerType=void 0,this.options=void 0}static removeUnsyncBytes(a){let e=0,t=0;for(;e<a.length-1;)e!==t&&(a[t]=a[e]),e+=255===a[e]&&0===a[e+1]?2:1,t++;return e<a.length&&(a[t++]=a[e]),a.subarray(0,t)}static getFrameHeaderLength(a){switch(a){case 2:return 6;case 3:case 4:return 10;default:throw y(a)}}static readFrameFlags(a){return{status:{tag_alter_preservation:s.mh(a,0,6),file_alter_preservation:s.mh(a,0,5),read_only:s.mh(a,0,4)},format:{grouping_identity:s.mh(a,1,7),compression:s.mh(a,1,3),encryption:s.mh(a,1,2),unsynchronisation:s.mh(a,1,1),data_length_indicator:s.mh(a,1,0)}}}static readFrameData(a,e,t,r,s){var i,n;const c=new u(t,s);switch(t){case 2:return c.readData(a,e.id,r);case 3:case 4:return null!==(i=e.flags)&&void 0!==i&&i.format.unsynchronisation&&(a=p.removeUnsyncBytes(a)),null!==(n=e.flags)&&void 0!==n&&n.format.data_length_indicator&&(a=a.subarray(4,a.length)),c.readData(a,e.id,r);default:throw y(t)}}static makeDescriptionTagName(a,e){return a+(e?":".concat(e):"")}async parse(a,e,t){this.tokenizer=e,this.metadata=a,this.options=t;const r=await this.tokenizer.readToken(n.yW);if("ID3"!==r.fileIdentifier)throw new g("expected ID3-header file-identifier 'ID3' was not found");return this.id3Header=r,this.headerType="ID3v2.".concat(r.version.major),r.flags.isExtendedHeader?this.parseExtendedHeader():this.parseId3Data(r.size)}async parseExtendedHeader(){const a=await this.tokenizer.readToken(n.nl),e=a.size-n.nl.len;return e>0?this.parseExtendedHeaderData(e,a.size):this.parseId3Data(this.id3Header.size-a.size)}async parseExtendedHeaderData(a,e){return await this.tokenizer.ignore(a),this.parseId3Data(this.id3Header.size-e)}async parseId3Data(a){const e=await this.tokenizer.readToken(new r.Uint8ArrayType(a));for(const t of this.parseMetadata(e))if("TXXX"===t.id)t.value&&await this.handleTag(t,t.value.text,()=>t.value.description);else await(Array.isArray(t.value)?Promise.all(t.value.map(a=>this.addTag(t.id,a))):this.addTag(t.id,t.value))}async handleTag(a,e,t){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:a=>a;await Promise.all(e.map(e=>this.addTag(p.makeDescriptionTagName(a.id,t(e)),r(e))))}async addTag(a,e){await this.metadata.addTag(this.headerType,a,e)}parseMetadata(a){let e=0;const t=[];for(;e!==a.length;){const r=p.getFrameHeaderLength(this.id3Header.version.major);if(e+r>a.length){this.metadata.addWarning("Illegal ID3v2 tag length");break}const s=a.subarray(e,e+r);e+=r;const i=this.readFrameHeader(s,this.id3Header.version.major),n=a.subarray(e,e+i.length);e+=i.length;const c=p.readFrameData(n,i,this.id3Header.version.major,!this.options.skipCovers,this.metadata);c&&t.push({id:i.id,value:c})}return t}readFrameHeader(a,e){let t;switch(e){case 2:t={id:(0,m.c)(a.subarray(0,3),"ascii"),length:r.UINT24_BE.get(a,3)},t.id.match(/[A-Z0-9]{3}/g)||this.metadata.addWarning("Invalid ID3v2.".concat(this.id3Header.version.major," frame-header-ID: ").concat(t.id));break;case 3:case 4:t={id:(0,m.c)(a.subarray(0,4),"ascii"),length:(4===e?n.St:r.UINT32_BE).get(a,4),flags:p.readFrameFlags(a.subarray(8,10))},t.id.match(/[A-Z0-9]{4}/g)||this.metadata.addWarning("Invalid ID3v2.".concat(this.id3Header.version.major," frame-header-ID: ").concat(t.id));break;default:throw y(e)}return t}}function y(a){throw new g("Unexpected majorVer: ".concat(a))}}}]);
//# sourceMappingURL=209.69980d84.chunk.js.map