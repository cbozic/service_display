"use strict";(self.webpackChunkservice_display=self.webpackChunkservice_display||[]).push([[343],{5343(e,t,a){a.r(t),a.d(t,{MP4Parser:()=>J});var s=a(6522),n=a(950),r=a(6663),i=a(2826),o=a(7986),c=a(1447),l=a(4152);const d=s("music-metadata:parser:MP4:atom");class h extends((0,c.fO)("MP4")){}const m={len:8,get:(e,t)=>{const a=n.UINT32_BE.get(e,t);if(a<0)throw new h("Invalid atom header length");return{length:BigInt(a),name:new n.StringType(4,"latin1").get(e,t+4)}},put:(e,t,a)=>(n.UINT32_BE.put(e,t,Number(a.length)),o.e.put(e,t+4,a.name))},g=n.UINT64_BE,p={len:4,get:(e,t)=>({type:new n.StringType(4,"ascii").get(e,t)})};class u{constructor(e,t,a){if(e<t)throw new h("Atom ".concat(a," expected to be ").concat(t,", but specifies ").concat(e," bytes long."));e>t&&d("Warning: atom ".concat(a," expected to be ").concat(t,", but was actually ").concat(e," bytes long.")),this.len=e}}const f=(e,t)=>{const a=n.UINT32_BE.get(e,t)-2082844800;return new Date(1e3*a)};class T extends u{constructor(e){super(e,24,"mdhd")}get(e,t){return{version:n.UINT8.get(e,t+0),flags:n.UINT24_BE.get(e,t+1),creationTime:f(e,t+4),modificationTime:f(e,t+8),timeScale:n.UINT32_BE.get(e,t+12),duration:n.UINT32_BE.get(e,t+16),language:n.UINT16_BE.get(e,t+20),quality:n.UINT16_BE.get(e,t+22)}}}class k extends u{constructor(e){super(e,100,"mvhd")}get(e,t){return{version:n.UINT8.get(e,t),flags:n.UINT24_BE.get(e,t+1),creationTime:f(e,t+4),modificationTime:f(e,t+8),timeScale:n.UINT32_BE.get(e,t+12),duration:n.UINT32_BE.get(e,t+16),preferredRate:n.UINT32_BE.get(e,t+20),preferredVolume:n.UINT16_BE.get(e,t+24),previewTime:n.UINT32_BE.get(e,t+72),previewDuration:n.UINT32_BE.get(e,t+76),posterTime:n.UINT32_BE.get(e,t+80),selectionTime:n.UINT32_BE.get(e,t+84),selectionDuration:n.UINT32_BE.get(e,t+88),currentTime:n.UINT32_BE.get(e,t+92),nextTrackID:n.UINT32_BE.get(e,t+96)}}}class I{constructor(e){this.len=e}get(e,t){return{type:{set:n.UINT8.get(e,t+0),type:n.UINT24_BE.get(e,t+1)},locale:n.UINT24_BE.get(e,t+4),value:new n.Uint8ArrayType(this.len-8).get(e,t+8)}}}class w{constructor(e){this.len=e}get(e,t){return{version:n.UINT8.get(e,t),flags:n.UINT24_BE.get(e,t+1),name:new n.StringType(this.len-4,"utf-8").get(e,t+4)}}}class N{constructor(e){this.len=e}get(e,t){return{version:n.UINT8.get(e,t),flags:n.UINT24_BE.get(e,t+1),creationTime:f(e,t+4),modificationTime:f(e,t+8),trackId:n.UINT32_BE.get(e,t+12),duration:n.UINT32_BE.get(e,t+20),layer:n.UINT16_BE.get(e,t+24),alternateGroup:n.UINT16_BE.get(e,t+26),volume:n.UINT16_BE.get(e,t+28)}}}const E=8,y=(e,t)=>({version:n.UINT8.get(e,t),flags:n.UINT24_BE.get(e,t+1),numberOfEntries:n.UINT32_BE.get(e,t+4)});class B{constructor(e){this.len=e}get(e,t){const a=this.len-12;return{dataFormat:o.e.get(e,t),dataReferenceIndex:n.UINT16_BE.get(e,t+10),description:a>0?new n.Uint8ArrayType(a).get(e,t+12):void 0}}}class b{constructor(e){this.len=e}get(e,t){const a=y(e,t);t+=E;const s=[];for(let r=0;r<a.numberOfEntries;++r){const a=n.UINT32_BE.get(e,t);t+=n.UINT32_BE.len,s.push(new B(a-n.UINT32_BE.len).get(e,t)),t+=a}return{header:a,table:s}}}const S={len:8,get:(e,t)=>({version:n.INT16_BE.get(e,t),revision:n.INT16_BE.get(e,t+2),vendor:n.INT32_BE.get(e,t+4)})},_={len:12,get:(e,t)=>({numAudioChannels:n.INT16_BE.get(e,t+0),sampleSize:n.INT16_BE.get(e,t+2),compressionId:n.INT16_BE.get(e,t+4),packetSize:n.INT16_BE.get(e,t+6),sampleRate:n.UINT16_BE.get(e,t+8)+n.UINT16_BE.get(e,t+10)/1e4})};class U{constructor(e,t){this.len=e,this.token=t}get(e,t){const a=n.INT32_BE.get(e,t+4);return{version:n.INT8.get(e,t+0),flags:n.INT24_BE.get(e,t+1),numberOfEntries:a,entries:F(e,this.token,t+8,this.len-8,a)}}}const z={len:8,get:(e,t)=>({count:n.INT32_BE.get(e,t+0),duration:n.INT32_BE.get(e,t+4)})};class P extends U{constructor(e){super(e,z)}}const v={len:12,get:(e,t)=>({firstChunk:n.INT32_BE.get(e,t),samplesPerChunk:n.INT32_BE.get(e,t+4),sampleDescriptionId:n.INT32_BE.get(e,t+8)})};class C extends U{constructor(e){super(e,v)}}class A{constructor(e){this.len=e}get(e,t){const a=n.INT32_BE.get(e,t+8);return{version:n.INT8.get(e,t),flags:n.INT24_BE.get(e,t+1),sampleSize:n.INT32_BE.get(e,t+4),numberOfEntries:a,entries:F(e,n.INT32_BE,t+12,this.len-12,a)}}}class D extends U{constructor(e){super(e,n.INT32_BE),this.len=e}}class x{constructor(e){this.len=e}get(e,t){const a=n.INT16_BE.get(e,t+0);return new n.StringType(a,"utf-8").get(e,t+2)}}function F(e,t,a,s,n){if(d("remainingLen=".concat(s,", numberOfEntries=").concat(n," * token-len=").concat(t.len)),0===s)return[];if(s!==n*t.len)throw new h("mismatch number-of-entries with remaining atom-length");const r=[];for(let i=0;i<n;++i)r.push(t.get(e,a)),a+=t.len;return r}class O{constructor(e){this.len=e}get(e,t){const a=t+1,s={version:n.INT8.get(e,t),flags:{baseDataOffsetPresent:l.mh(e,a+2,0),sampleDescriptionIndexPresent:l.mh(e,a+2,1),defaultSampleDurationPresent:l.mh(e,a+2,3),defaultSampleSizePresent:l.mh(e,a+2,4),defaultSampleFlagsPresent:l.mh(e,a+2,5),defaultDurationIsEmpty:l.mh(e,a,0),defaultBaseIsMoof:l.mh(e,a,1)},trackId:n.UINT32_BE.get(e,4)};let r=8;return s.flags.baseDataOffsetPresent&&(s.baseDataOffset=n.UINT64_BE.get(e,r),r+=8),s.flags.sampleDescriptionIndexPresent&&(s.sampleDescriptionIndex=n.UINT32_BE.get(e,r),r+=4),s.flags.defaultSampleDurationPresent&&(s.defaultSampleDuration=n.UINT32_BE.get(e,r),r+=4),s.flags.defaultSampleSizePresent&&(s.defaultSampleSize=n.UINT32_BE.get(e,r),r+=4),s.flags.defaultSampleFlagsPresent&&(s.defaultSampleFlags=n.UINT32_BE.get(e,r)),s}}class L{constructor(e){this.len=e}get(e,t){const a=t+1,s={version:n.INT8.get(e,t),flags:{dataOffsetPresent:l.mh(e,a+2,0),firstSampleFlagsPresent:l.mh(e,a+2,2),sampleDurationPresent:l.mh(e,a+1,0),sampleSizePresent:l.mh(e,a+1,1),sampleFlagsPresent:l.mh(e,a+1,2),sampleCompositionTimeOffsetsPresent:l.mh(e,a+1,3)},sampleCount:n.UINT32_BE.get(e,t+4),samples:[]};let r=t+8;s.flags.dataOffsetPresent&&(s.dataOffset=n.UINT32_BE.get(e,r),r+=4),s.flags.firstSampleFlagsPresent&&(s.firstSampleFlags=n.UINT32_BE.get(e,r),r+=4);for(let i=0;i<s.sampleCount;++i){if(r>=this.len){d("TrackRunBox size mismatch");break}const t={};s.flags.sampleDurationPresent&&(t.sampleDuration=n.UINT32_BE.get(e,r),r+=4),s.flags.sampleSizePresent&&(t.sampleSize=n.UINT32_BE.get(e,r),r+=4),s.flags.sampleFlagsPresent&&(t.sampleFlags=n.UINT32_BE.get(e,r),r+=4),s.flags.sampleCompositionTimeOffsetsPresent&&(t.sampleCompositionTimeOffset=n.UINT32_BE.get(e,r),r+=4),s.samples.push(t)}return s}}class M{constructor(e){this.len=e}get(e,t){const a=new n.StringType(4,"utf-8");return{version:n.INT8.get(e,t),flags:n.UINT24_BE.get(e,t+1),componentType:a.get(e,t+4),handlerType:a.get(e,t+8),componentName:new n.StringType(this.len-28,"utf-8").get(e,t+28)}}}class R{constructor(e){this.len=e}get(e,t){let a=0;const s=[];for(;a<this.len;)s.push(n.UINT32_BE.get(e,t+a)),a+=4;return s}}const V=s("music-metadata:parser:MP4:Atom");class W{static async readAtom(e,t,a,s){const n=e.position;V("Reading next token on offset=".concat(n,"..."));const r=await e.readToken(m),i=1n===r.length;i&&(r.length=await e.readToken(g));const o=new W(r,i,a),c=o.getPayloadLength(s);return V("parse atom name=".concat(o.atomPath,", extended=").concat(o.extended,", offset=").concat(n,", len=").concat(o.header.length)),await o.readData(e,t,c),o}constructor(e,t,a){this.header=e,this.extended=t,this.parent=a,this.children=[],this.atomPath=(this.parent?"".concat(this.parent.atomPath,"."):"")+this.header.name}getHeaderLength(){return this.extended?16:8}getPayloadLength(e){return(0n===this.header.length?e:Number(this.header.length))-this.getHeaderLength()}async readAtoms(e,t,a){for(;a>0;){const s=await W.readAtom(e,t,this,a);this.children.push(s),a-=0n===s.header.length?a:Number(s.header.length)}}async readData(e,t,a){switch(this.header.name){case"moov":case"udta":case"mdia":case"minf":case"stbl":case"<id>":case"ilst":case"tref":case"moof":return this.readAtoms(e,t,this.getPayloadLength(a));case"meta":{const s="hdlr"===(await e.peekToken(m)).name?0:4;return await e.ignore(s),this.readAtoms(e,t,this.getPayloadLength(a)-s)}default:return t(this,a)}}}var j=a(1836),q=a(7412),G=a(3176);const H=s("music-metadata:parser:MP4"),Q={raw:{lossy:!1,format:"raw"},MAC3:{lossy:!0,format:"MACE 3:1"},MAC6:{lossy:!0,format:"MACE 6:1"},ima4:{lossy:!0,format:"IMA 4:1"},ulaw:{lossy:!0,format:"uLaw 2:1"},alaw:{lossy:!0,format:"uLaw 2:1"},Qclp:{lossy:!0,format:"QUALCOMM PureVoice"},".mp3":{lossy:!0,format:"MPEG-1 layer 3"},alac:{lossy:!1,format:"ALAC"},"ac-3":{lossy:!0,format:"AC-3"},mp4a:{lossy:!0,format:"MPEG-4/AAC"},mp4s:{lossy:!0,format:"MP4S"},c608:{lossy:!0,format:"CEA-608"},c708:{lossy:!0,format:"CEA-708"}};function Y(e,t,a){return a.indexOf(e)===t}class J extends r.s{constructor(){super(...arguments),this.tracks=new Map,this.hasVideoTrack=!1,this.hasAudioTrack=!0,this.atomParsers={mvhd:async e=>{const t=await this.tokenizer.readToken(new k(e));this.metadata.setFormat("creationTime",t.creationTime),this.metadata.setFormat("modificationTime",t.modificationTime)},chap:async e=>{const t=this.getTrackDescription(),a=[];for(;e>=n.UINT32_BE.len;)a.push(await this.tokenizer.readNumber(n.UINT32_BE)),e-=n.UINT32_BE.len;t.chapterList=a},mdat:async e=>{if(this.options.includeChapters){const t=[...this.tracks.values()].filter(e=>e.chapterList);if(1===t.length){const a=t[0].chapterList,s=[...this.tracks.values()].filter(e=>-1!==a.indexOf(e.header.trackId));if(1===s.length)return this.parseChapterTrack(s[0],t[0],e)}}await this.tokenizer.ignore(e)},ftyp:async e=>{const t=[];for(;e>0;){const a=await this.tokenizer.readToken(p);e-=p.len;const s=a.type.replace(/\W/g,"");s.length>0&&t.push(s)}H("ftyp: ".concat(t.join("/")));const a=t.filter(Y).join("/");this.metadata.setFormat("container",a)},stsd:async e=>{const t=await this.tokenizer.readToken(new b(e));this.getTrackDescription().soundSampleDescription=t.table.map(e=>this.parseSoundSampleDescription(e))},stsz:async e=>{const t=await this.tokenizer.readToken(new A(e)),a=this.getTrackDescription();a.sampleSize=t.sampleSize,a.sampleSizeTable=t.entries},date:async e=>{const t=await this.tokenizer.readToken(new n.StringType(e,"utf-8"));await this.addTag("date",t)}}}static read_BE_Integer(e,t){const a=(t?"INT":"UINT")+8*e.length+(e.length>1?"_BE":""),s=n[a];if(!s)throw new h('Token for integer type not found: "'.concat(a,'"'));return Number(s.get(e,0))}async parse(){this.hasVideoTrack=!1,this.hasAudioTrack=!0,this.tracks.clear();let e=this.tokenizer.fileInfo.size||0;for(;!this.tokenizer.fileInfo.size||e>0;){try{if("\0\0\0\0"===(await this.tokenizer.peekToken(m)).name){const e="Error at offset=".concat(this.tokenizer.position,": box.id=0");H(e),this.addWarning(e);break}}catch(o){if(!(o instanceof Error))throw o;{const e="Error at offset=".concat(this.tokenizer.position,": ").concat(o.message);H(e),this.addWarning(e)}break}const t=await W.readAtom(this.tokenizer,(e,t)=>this.handleAtom(e,t),null,e);e-=t.header.length===BigInt(0)?e:Number(t.header.length)}const t=[];this.tracks.forEach(e=>{const a=[];e.soundSampleDescription.forEach(e=>{const t={},s=Q[e.dataFormat];if(s?(a.push(s.format),t.codecName=s.format):t.codecName="<".concat(e.dataFormat,">"),e.description){const{description:a}=e;a.sampleRate>0&&(t.type=j.S.audio,t.audio={samplingFrequency:a.sampleRate,bitDepth:a.sampleSize,channels:a.numAudioChannels})}this.metadata.addStreamInfo(t)}),a.length>=1&&t.push(a.join("/"))}),t.length>0&&this.metadata.setFormat("codec",t.filter(Y).join("+"));const a=[...this.tracks.values()].filter(e=>e.soundSampleDescription.length>=1&&e.soundSampleDescription[0].description&&e.soundSampleDescription[0].description.numAudioChannels>0);for(const c of a){if(c.media.header&&c.media.header.timeScale>0)if(c.sampleRate=c.media.header.timeScale,c.media.header.duration>0&&(H("Using duration defined on audio track"),c.samples=c.media.header.duration,c.duration=c.samples/c.sampleRate),c.fragments.length>0){H("Calculate duration defined in track fragments");let e=0;c.sizeInBytes=0;for(const t of c.fragments)for(const a of t.trackRun.samples){var s,n,r,i;const o=null!==(s=null!==(n=a.sampleDuration)&&void 0!==n?n:t.header.defaultSampleDuration)&&void 0!==s?s:0,l=null!==(r=null!==(i=a.sampleSize)&&void 0!==i?i:t.header.defaultSampleSize)&&void 0!==r?r:0;if(0===o)throw new Error("Missing sampleDuration and no defaultSampleDuration in track fragment header");if(0===l)throw new Error("Missing sampleSize and no defaultSampleSize in track fragment header");e+=o,c.sizeInBytes+=l}c.samples||(c.samples=e),c.duration||(c.duration=e/c.sampleRate)}else c.sampleSizeTable.length>0&&(c.sizeInBytes=c.sampleSizeTable.reduce((e,t)=>e+t,0));const e=c.soundSampleDescription[0];if(e.description&&c.media.header&&(this.metadata.setFormat("sampleRate",e.description.sampleRate),this.metadata.setFormat("bitsPerSample",e.description.sampleSize),this.metadata.setFormat("numberOfChannels",e.description.numAudioChannels),0===c.media.header.timeScale&&c.timeToSampleTable.length>0)){const t=c.timeToSampleTable.map(e=>e.count*e.duration).reduce((e,t)=>e+t);c.duration=t/e.description.sampleRate}const t=Q[e.dataFormat];t&&this.metadata.setFormat("lossless",!t.lossy)}if(a.length>=1){const e=a[0];e.duration&&(this.metadata.setFormat("duration",e.duration),e.sizeInBytes&&this.metadata.setFormat("bitrate",8*e.sizeInBytes/e.duration))}this.metadata.setFormat("hasAudio",this.hasAudioTrack),this.metadata.setFormat("hasVideo",this.hasVideoTrack)}async handleAtom(e,t){if(e.parent)switch(e.parent.header.name){case"ilst":case"<id>":return this.parseMetadataItemData(e);case"moov":switch(e.header.name){case"trak":case"udta":return this.parseTrackBox(e)}break;case"moof":if("traf"===e.header.name)return this.parseTrackFragmentBox(e)}if(this.atomParsers[e.header.name])return this.atomParsers[e.header.name](t);H("No parser for atom path=".concat(e.atomPath,", payload-len=").concat(t,", ignoring atom")),await this.tokenizer.ignore(t)}getTrackDescription(){const e=[...this.tracks.values()];return e[e.length-1]}async addTag(e,t){await this.metadata.addTag("iTunes",e,t)}addWarning(e){H("Warning: ".concat(e)),this.metadata.addWarning(e)}parseMetadataItemData(e){let t=e.header.name;return e.readAtoms(this.tokenizer,async(e,a)=>{const s=e.getPayloadLength(a);switch(e.header.name){case"data":return this.parseValueAtom(t,e);case"name":case"mean":case"rate":{const e=await this.tokenizer.readToken(new w(s));t+=":".concat(e.name);break}default:{const a=await this.tokenizer.readToken(new n.Uint8ArrayType(s));this.addWarning("Unsupported meta-item: ".concat(t,"[").concat(e.header.name,"] => value=").concat((0,q.EY)(a)," ascii=").concat((0,G.c)(a,"ascii")))}}},e.getPayloadLength(0))}async parseValueAtom(e,t){const a=await this.tokenizer.readToken(new I(Number(t.header.length)-m.len));if(0!==a.type.set)throw new h("Unsupported type-set != 0: ".concat(a.type.set));switch(a.type.type){case 0:switch(e){case"trkn":case"disk":{const t=n.UINT8.get(a.value,3),s=n.UINT8.get(a.value,5);await this.addTag(e,"".concat(t,"/").concat(s));break}case"gnre":{const t=n.UINT8.get(a.value,1),s=i.jR[t-1];await this.addTag(e,s);break}case"rate":{const t=(0,G.c)(a.value,"ascii");await this.addTag(e,t);break}default:H("unknown proprietary value type for: ".concat(t.atomPath))}break;case 1:case 18:await this.addTag(e,(0,G.c)(a.value));break;case 13:if(this.options.skipCovers)break;await this.addTag(e,{format:"image/jpeg",data:Uint8Array.from(a.value)});break;case 14:if(this.options.skipCovers)break;await this.addTag(e,{format:"image/png",data:Uint8Array.from(a.value)});break;case 21:await this.addTag(e,J.read_BE_Integer(a.value,!0));break;case 22:await this.addTag(e,J.read_BE_Integer(a.value,!1));break;case 65:await this.addTag(e,n.UINT8.get(a.value,0));break;case 66:await this.addTag(e,n.UINT16_BE.get(a.value,0));break;case 67:await this.addTag(e,n.UINT32_BE.get(a.value,0));break;default:this.addWarning("atom key=".concat(e,", has unknown well-known-type (data-type): ").concat(a.type.type))}}async parseTrackBox(e){const t={media:{},fragments:[]};await e.readAtoms(this.tokenizer,async(e,a)=>{const s=e.getPayloadLength(a);switch(e.header.name){case"chap":{const e=await this.tokenizer.readToken(new R(a));t.chapterList=e;break}case"tkhd":t.header=await this.tokenizer.readToken(new N(s));break;case"hdlr":t.handler=await this.tokenizer.readToken(new M(s)),t.isAudio=()=>"audi"===t.handler.handlerType||"soun"===t.handler.handlerType,t.isVideo=()=>"vide"===t.handler.handlerType,t.isAudio()?this.hasAudioTrack=!0:t.isVideo()&&(this.hasVideoTrack=!0);break;case"mdhd":{const e=await this.tokenizer.readToken(new T(s));t.media.header=e;break}case"stco":{const e=await this.tokenizer.readToken(new D(s));t.chunkOffsetTable=e.entries;break}case"stsc":{const e=await this.tokenizer.readToken(new C(s));t.sampleToChunkTable=e.entries;break}case"stsd":{const e=await this.tokenizer.readToken(new b(s));t.soundSampleDescription=e.table.map(e=>this.parseSoundSampleDescription(e));break}case"stts":{const e=await this.tokenizer.readToken(new P(s));t.timeToSampleTable=e.entries;break}case"stsz":{const e=await this.tokenizer.readToken(new A(s));t.sampleSize=e.sampleSize,t.sampleSizeTable=e.entries;break}case"dinf":case"vmhd":case"smhd":H("Ignoring: ".concat(e.header.name)),await this.tokenizer.ignore(s);break;default:H("Unexpected track box: ".concat(e.header.name)),await this.tokenizer.ignore(s)}},e.getPayloadLength(0)),this.tracks.set(t.header.trackId,t)}parseTrackFragmentBox(e){let t;return e.readAtoms(this.tokenizer,async(e,a)=>{const s=e.getPayloadLength(a);switch(e.header.name){case"tfhd":{const s=new O(e.getPayloadLength(a));t=await this.tokenizer.readToken(s);break}case"tfdt":await this.tokenizer.ignore(s);break;case"trun":{const e=new L(s),a=await this.tokenizer.readToken(e);if(t){const e=this.tracks.get(t.trackId);null===e||void 0===e||e.fragments.push({header:t,trackRun:a})}break}default:H("Unexpected box: ".concat(e.header.name)),await this.tokenizer.ignore(s)}},e.getPayloadLength(0))}parseSoundSampleDescription(e){const t={dataFormat:e.dataFormat,dataReferenceIndex:e.dataReferenceIndex};let a=0;if(e.description){const s=S.get(e.description,a);a+=S.len,0===s.version||1===s.version?t.description=_.get(e.description,a):H("Warning: sound-sample-description ".concat(s," not implemented"))}return t}async parseChapterTrack(e,t,a){if(!e.sampleSize&&e.chunkOffsetTable.length!==e.sampleSizeTable.length)throw new Error("Expected equal chunk-offset-table & sample-size-table length.");const s=[];for(let n=0;n<e.chunkOffsetTable.length&&a>0;++n){const r=e.timeToSampleTable.slice(0,n).reduce((e,t)=>e+t.duration,0),i=e.chunkOffsetTable[n]-this.tokenizer.position,o=e.sampleSize>0?e.sampleSize:e.sampleSizeTable[n];if((a-=i+o)<0)throw new h("Chapter chunk exceeding token length");await this.tokenizer.ignore(i);const c=await this.tokenizer.readToken(new x(o));H("Chapter ".concat(n+1,": ").concat(c));const l={title:c,timeScale:e.media.header?e.media.header.timeScale:0,start:r,sampleOffset:this.findSampleOffset(t,this.tokenizer.position)};H("Chapter title=".concat(l.title,", offset=").concat(l.sampleOffset,"/").concat(t.header.duration)),s.push(l)}this.metadata.setFormat("chapters",s),await this.tokenizer.ignore(a)}findSampleOffset(e,t){let a=0;for(;a<e.chunkOffsetTable.length&&e.chunkOffsetTable[a]<t;)++a;return this.getChunkDuration(a+1,e)}getChunkDuration(e,t){let a=0,s=t.timeToSampleTable[a].count,n=t.timeToSampleTable[a].duration,r=1,i=this.getSamplesPerChunk(r,t.sampleToChunkTable),o=0;for(;r<e;){const e=Math.min(s,i);o+=e*n,s-=e,i-=e,0===i?(++r,i=this.getSamplesPerChunk(r,t.sampleToChunkTable)):(++a,s=t.timeToSampleTable[a].count,n=t.timeToSampleTable[a].duration)}return o}getSamplesPerChunk(e,t){for(let a=0;a<t.length-1;++a)if(e>=t[a].firstChunk&&e<t[a+1].firstChunk)return t[a].samplesPerChunk;return t[t.length-1].samplesPerChunk}}}}]);
//# sourceMappingURL=343.584f2fd5.chunk.js.map