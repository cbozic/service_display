"use strict";(self.webpackChunkservice_display=self.webpackChunkservice_display||[]).push([[662],{4662:(e,t,a)=>{a.r(t),a.d(t,{WaveParser:()=>C});var n=a(75),i=a(9726),s=a(6522);const r={len:8,get:(e,t)=>({chunkID:new i.StringType(4,"latin1").get(e,t),chunkSize:i.UINT32_LE.get(e,t+4)})};class o{constructor(e){this.tagHeader=e,this.len=e.chunkSize,this.len+=1&this.len}get(e,t){return new i.StringType(this.tagHeader.chunkSize,"ascii").get(e,t)}}var c=a(1447);class h extends((0,c.fO)("Wave")){}const k=1,d=2,g=3,m=5632,l=5634,u=255,I=146,T=8192,S=576,f=577,p=9,w=8193,z=80,F={[k]:"PCM",[d]:"ADPCM",[g]:"IEEE_FLOAT",[m]:"MPEG_ADTS_AAC",[l]:"MPEG_LOAS",[u]:"RAW_AAC1",[I]:"DOLBY_AC3_SPDIF",[T]:"DVM",[S]:"RAW_SPORT",[f]:"ESST_AC3",[p]:"DRM",[w]:"DTS2",[z]:"MPEG"};class L{constructor(e){if(e.chunkSize<16)throw new h("Invalid chunk size");this.len=e.chunkSize}get(e,t){return{wFormatTag:i.UINT16_LE.get(e,t),nChannels:i.UINT16_LE.get(e,t+2),nSamplesPerSec:i.UINT32_LE.get(e,t+4),nAvgBytesPerSec:i.UINT32_LE.get(e,t+8),nBlockAlign:i.UINT16_LE.get(e,t+12),wBitsPerSample:i.UINT16_LE.get(e,t+14)}}}class A{constructor(e){if(e.chunkSize<4)throw new h("Invalid fact chunk size.");this.len=e.chunkSize}get(e,t){return{dwSampleLength:i.UINT32_LE.get(e,t)}}}var E=a(6209),R=a(4152),y=a(7986),_=a(6663);const b={len:420,get:(e,t)=>({description:(0,R.F6)(new i.StringType(256,"ascii").get(e,t)).trim(),originator:(0,R.F6)(new i.StringType(32,"ascii").get(e,t+256)).trim(),originatorReference:(0,R.F6)(new i.StringType(32,"ascii").get(e,t+288)).trim(),originationDate:(0,R.F6)(new i.StringType(10,"ascii").get(e,t+320)).trim(),originationTime:(0,R.F6)(new i.StringType(8,"ascii").get(e,t+330)).trim(),timeReferenceLow:i.UINT32_LE.get(e,t+338),timeReferenceHigh:i.UINT32_LE.get(e,t+342),version:i.UINT16_LE.get(e,t+346),umid:new i.Uint8ArrayType(64).get(e,t+348),loudnessValue:i.UINT16_LE.get(e,t+412),maxTruePeakLevel:i.UINT16_LE.get(e,t+414),maxMomentaryLoudness:i.UINT16_LE.get(e,t+416),maxShortTermLoudness:i.UINT16_LE.get(e,t+418)})},D=s("music-metadata:parser:RIFF");class C extends _.s{constructor(){super(...arguments),this.blockAlign=0}async parse(){const e=await this.tokenizer.readToken(r);if(D("pos=".concat(this.tokenizer.position,", parse: chunkID=").concat(e.chunkID)),"RIFF"===e.chunkID)return this.metadata.setAudioOnly(),this.parseRiffChunk(e.chunkSize).catch(e=>{if(!(e instanceof n.d1))throw e})}async parseRiffChunk(e){const t=await this.tokenizer.readToken(y.e);if(this.metadata.setFormat("container",t),"WAVE"===t)return this.readWaveChunk(e-y.e.len);throw new h("Unsupported RIFF format: RIFF/".concat(t))}async readWaveChunk(e){for(;e>=r.len;){const t=await this.tokenizer.readToken(r);switch(e-=r.len+t.chunkSize,t.chunkSize>e&&this.metadata.addWarning("Data chunk size exceeds file size"),this.header=t,D("pos=".concat(this.tokenizer.position,", readChunk: chunkID=RIFF/WAVE/").concat(t.chunkID)),t.chunkID){case"LIST":await this.parseListTag(t);break;case"fact":this.metadata.setFormat("lossless",!1),this.fact=await this.tokenizer.readToken(new A(t));break;case"fmt ":{const e=await this.tokenizer.readToken(new L(t));let a=F[e.wFormatTag];a||(D("WAVE/non-PCM format=".concat(e.wFormatTag)),a="non-PCM (".concat(e.wFormatTag,")")),this.metadata.setFormat("codec",a),this.metadata.setFormat("bitsPerSample",e.wBitsPerSample),this.metadata.setFormat("sampleRate",e.nSamplesPerSec),this.metadata.setFormat("numberOfChannels",e.nChannels),this.metadata.setFormat("bitrate",e.nBlockAlign*e.nSamplesPerSec*8),this.blockAlign=e.nBlockAlign;break}case"id3 ":case"ID3 ":{const e=await this.tokenizer.readToken(new i.Uint8ArrayType(t.chunkSize)),a=n.vY(e);await(new E.S).parse(this.metadata,a,this.options);break}case"data":{!1!==this.metadata.format.lossless&&this.metadata.setFormat("lossless",!0);let e=t.chunkSize;if(this.tokenizer.fileInfo.size){const t=this.tokenizer.fileInfo.size-this.tokenizer.position;t<e&&(this.metadata.addWarning("data chunk length exceeding file length"),e=t)}const a=this.fact?this.fact.dwSampleLength:4294967295===e?void 0:e/this.blockAlign;a&&(this.metadata.setFormat("numberOfSamples",a),this.metadata.format.sampleRate&&this.metadata.setFormat("duration",a/this.metadata.format.sampleRate)),"ADPCM"===this.metadata.format.codec?this.metadata.setFormat("bitrate",352e3):this.metadata.format.sampleRate&&this.metadata.setFormat("bitrate",this.blockAlign*this.metadata.format.sampleRate*8),await this.tokenizer.ignore(t.chunkSize);break}case"bext":{const e=await this.tokenizer.readToken(b);Object.keys(e).forEach(t=>{this.metadata.addTag("exif","bext.".concat(t),e[t])});const a=t.chunkSize-b.len;await this.tokenizer.ignore(a);break}case"\0\0\0\0":D("Ignore padding chunk: RIFF/".concat(t.chunkID," of ").concat(t.chunkSize," bytes")),this.metadata.addWarning("Ignore chunk: RIFF/".concat(t.chunkID)),await this.tokenizer.ignore(t.chunkSize);break;default:D("Ignore chunk: RIFF/".concat(t.chunkID," of ").concat(t.chunkSize," bytes")),this.metadata.addWarning("Ignore chunk: RIFF/".concat(t.chunkID)),await this.tokenizer.ignore(t.chunkSize)}this.header.chunkSize%2===1&&(D("Read odd padding byte"),await this.tokenizer.ignore(1))}}async parseListTag(e){const t=await this.tokenizer.readToken(new i.StringType(4,"latin1"));return D("pos=%s, parseListTag: chunkID=RIFF/WAVE/LIST/%s",this.tokenizer.position,t),"INFO"===t?this.parseRiffInfoTags(e.chunkSize-4):(this.metadata.addWarning("Ignore chunk: RIFF/WAVE/LIST/".concat(t)),D("Ignoring chunkID=RIFF/WAVE/LIST/".concat(t)),this.tokenizer.ignore(e.chunkSize-4).then())}async parseRiffInfoTags(e){for(;e>=8;){const t=await this.tokenizer.readToken(r),a=new o(t),n=await this.tokenizer.readToken(a);this.addTag(t.chunkID,R.F6(n)),e-=8+a.len}if(0!==e)throw new h("Illegal remaining size: ".concat(e))}addTag(e,t){this.metadata.addTag("exif",e,t)}}}}]);
//# sourceMappingURL=662.e1d4afb4.chunk.js.map